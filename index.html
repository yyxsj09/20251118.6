<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½éŸ³æŠ“ç”Ÿè©</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --bg-color: #f4f7f6;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            user-select: none; /* ç¦æ­¢é¸å–æ–‡å­— */
        }

        /* é ‚éƒ¨è³‡è¨Šåˆ— */
        .header-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            font-size: 1.2em;
            font-weight: bold;
            color: #555;
        }

        .lives { color: var(--error-color); }
        .progress { color: var(--primary-color); }

        /* ä¸­å¤®æ’­æ”¾æŒ‰éˆ• */
        .play-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: 8px solid rgba(255,255,255,0.5);
            font-size: 3em;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(52, 152, 219, 0.3);
            transition: transform 0.1s, background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .play-btn:active { transform: scale(0.95); }
        .play-btn:hover { background-color: #2980b9; }
        
        /* æ’­æ”¾æ™‚çš„æ³¢ç´‹å‹•ç•« */
        .playing { animation: pulse-shadow 1s infinite; }
        @keyframes pulse-shadow {
            0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(52, 152, 219, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
        }

        /* å–®å­—ç¶²æ ¼å€ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 900px;
        }

        .word-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px 10px;
            text-align: center;
            font-size: 1.8em;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #ccc;
            position: relative;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-card:hover { transform: translateY(-2px); }
        .word-card:active { 
            transform: translateY(2px); 
            box-shadow: 0 1px 0 #ccc;
        }

        /* å‹•ç•«èˆ‡ç‹€æ…‹ Class */
        .correct-anim {
            background-color: var(--success-color) !important;
            color: white !important;
            border-color: var(--success-color) !important;
            transform: scale(1.1);
        }

        .wrong-anim {
            background-color: var(--error-color) !important;
            color: white !important;
            border-color: var(--error-color) !important;
            animation: shake 0.5s;
        }

        .fade-out {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s;
        }

        .empty-slot {
            visibility: hidden; /* ä½”ä½ä½†ä¸é¡¯ç¤º */
            pointer-events: none;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        /* é®ç½©å±¤ (çµæŸç•«é¢) */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            text-align: center;
        }
        
        .overlay h2 { font-size: 3em; margin-bottom: 20px; }
        .btn-restart {
            padding: 15px 40px;
            font-size: 1.5em;
            background: var(--success-color);
            border: none;
            color: white;
            border-radius: 50px;
            cursor: pointer;
        }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 768px) {
            .grid-container { grid-template-columns: repeat(3, 1fr); }
            .word-card { font-size: 1.4em; }
        }
        @media (max-width: 480px) {
            .grid-container { grid-template-columns: repeat(2, 1fr); }
        }

    </style>
</head>
<body>

    <div class="header-bar">
        <div class="progress">å¾…è§£å–®å­—: <span id="remain-count">0</span></div>
        <div class="lives">ç”Ÿå‘½: <span id="lives-display">â¤â¤â¤</span></div>
    </div>

    <button class="play-btn" id="play-audio-btn" onclick="playTargetSound()">
        ğŸ”Š
    </button>
    <div style="color:#666; margin-bottom: 20px;">(é»æ“Šå–‡å­è½ç™¼éŸ³ï¼Œé¸å‡ºæ­£ç¢ºçš„å­—)</div>

    <div class="grid-container" id="game-grid">
        </div>

    <div id="overlay" class="overlay">
        <h2 id="end-title">éŠæˆ²çµæŸ</h2>
        <p id="end-msg" style="font-size: 1.5em; margin-bottom: 30px;"></p>
        <button class="btn-restart" onclick="initGame()">å†ä¾†ä¸€æ¬¡</button>
    </div>

    <script src="words.js"></script>

    <script>
        // --- éŠæˆ²åƒæ•¸ ---
        const MAX_LIVES = 3;
        const DISPLAY_COUNT = 10; // ç•«é¢ä¸Šæœ€å¤šé¡¯ç¤ºå¹¾å€‹å­—

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let pool = [];          // å°šæœªé¡¯ç¤ºçš„å–®å­—åº«
        let onScreenWords = []; // ç›®å‰ç•«é¢ä¸Šçš„å–®å­— (ç‰©ä»¶é™£åˆ—ï¼Œå¯èƒ½åŒ…å« null)
        let targetWord = null;  // ç•¶å‰è¦è½çš„é‚£å€‹å­—
        let lives = MAX_LIVES;
        let isProcessing = false; // é˜²æ­¢é€£é»

        // DOM å…ƒç´ 
        const grid = document.getElementById('game-grid');
        const livesDisplay = document.getElementById('lives-display');
        const remainDisplay = document.getElementById('remain-count');
        const playBtn = document.getElementById('play-audio-btn');
        const overlay = document.getElementById('overlay');
        const endTitle = document.getElementById('end-title');
        const endMsg = document.getElementById('end-msg');

        // æª¢æŸ¥æª”æ¡ˆ
        if (typeof wordData === 'undefined') {
            alert("éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° words.js");
        }

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        // åˆå§‹åŒ–
        function initGame() {
            // 1. é‡ç½®è®Šæ•¸
            lives = MAX_LIVES;
            pool = shuffle([...wordData]); // è¤‡è£½ä¸¦æ´—ç‰Œ
            onScreenWords = new Array(DISPLAY_COUNT).fill(null);
            isProcessing = false;
            overlay.style.display = 'none';
            
            // 2. å¡«æ»¿ç•«é¢ (å¦‚æœå–®å­—ä¸å¤  10 å€‹ï¼Œå°±å…¨æ”¾)
            grid.innerHTML = '';
            for(let i=0; i<DISPLAY_COUNT; i++) {
                // å»ºç«‹ç©ºçš„ DOM æ ¼å­
                let card = document.createElement('div');
                card.className = 'word-card empty-slot';
                card.id = `slot-${i}`;
                card.onclick = () => checkAnswer(i);
                grid.appendChild(card);

                // å¦‚æœæ± å­é‚„æœ‰å­—ï¼Œå°±å¡«å…¥
                if (pool.length > 0) {
                    fillSlot(i, pool.pop());
                }
            }

            updateUI();
            pickNewTarget();
        }

        // å¡«å…¥å–®å­—åˆ°æŒ‡å®šæ ¼å­
        function fillSlot(index, wordObj) {
            onScreenWords[index] = wordObj;
            const el = document.getElementById(`slot-${index}`);
            el.textContent = wordObj.word;
            el.classList.remove('empty-slot', 'fade-out', 'correct-anim');
            // éš¨æ©Ÿå‹•ç•«é€²å ´ (é¸ç”¨)
        }

        // æ¸…ç©ºæŒ‡å®šæ ¼å­
        function emptySlot(index) {
            onScreenWords[index] = null;
            const el = document.getElementById(`slot-${index}`);
            el.classList.add('fade-out'); // æ’­æ”¾æ¶ˆå¤±å‹•ç•«
            setTimeout(() => {
                el.classList.add('empty-slot');
                el.textContent = '';
            }, 300);
        }

        // é¸å‡ºæ–°çš„ç›®æ¨™å–®å­—
        function pickNewTarget() {
            // éæ¿¾å‡ºç›®å‰ç•«é¢ä¸Šã€Œéç©ºã€çš„å–®å­—
            const validWords = onScreenWords.filter(w => w !== null);

            if (validWords.length === 0) {
                gameWin();
                return;
            }

            // éš¨æ©Ÿé¸ä¸€å€‹
            targetWord = validWords[Math.floor(Math.random() * validWords.length)];
            
            // è‡ªå‹•æ’­æ”¾è²éŸ³ (å»¶é²ä¸€é»é»è®“ç©å®¶æº–å‚™)
            setTimeout(playTargetSound, 500);
        }

        // æ’­æ”¾è²éŸ³
        function playTargetSound() {
            if (!targetWord) return;
            
            // è¦–è¦ºæ•ˆæœ
            playBtn.classList.add('playing');
            setTimeout(() => playBtn.classList.remove('playing'), 1000);

            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(targetWord.word);
                utterance.lang = 'zh-TW';
                utterance.rate = 0.6; // è½å¯«å¯ä»¥ç¨å¾®æ…¢ä¸€é»
                window.speechSynthesis.speak(utterance);
            }
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer(slotIndex) {
            if (isProcessing || lives <= 0) return;
            
            const clickedWord = onScreenWords[slotIndex];
            if (!clickedWord) return; // é»åˆ°ç©ºä½

            const cardEl = document.getElementById(`slot-${slotIndex}`);

            if (clickedWord.word === targetWord.word) {
                // --- ç­”å° ---
                isProcessing = true; // é–å®šé˜²æ­¢é€£é»
                cardEl.classList.add('correct-anim'); // ç¶ è‰²é–ƒçˆ
                
                // æ’­æ”¾éŸ³æ•ˆ (é¸ç”¨)
                // new Audio('correct.mp3').play();

                setTimeout(() => {
                    // 1. èˆŠçš„æ¶ˆå¤±
                    emptySlot(slotIndex);

                    // 2. å˜—è©¦å¾æ± å­éè£œæ–°çš„
                    if (pool.length > 0) {
                        setTimeout(() => {
                            fillSlot(slotIndex, pool.pop());
                            updateUI();
                            isProcessing = false;
                            pickNewTarget(); // é‡æ–°é¸é¡Œç›®
                        }, 300);
                    } else {
                        // æ± å­ç©ºäº†ï¼Œå°±ä¸è£œï¼Œç›´æ¥é¸ä¸‹ä¸€é¡Œ
                        updateUI();
                        isProcessing = false;
                        pickNewTarget();
                    }
                    
                }, 500);

            } else {
                // --- ç­”éŒ¯ ---
                cardEl.classList.add('wrong-anim');
                setTimeout(() => cardEl.classList.remove('wrong-anim'), 500);
                
                lives--;
                updateUI();

                if (lives <= 0) {
                    gameOver();
                }
            }
        }

        function updateUI() {
            // æ›´æ–°æ„›å¿ƒ
            let hearts = "";
            for(let i=0; i<lives; i++) hearts += "â¤";
            livesDisplay.textContent = hearts;

            // æ›´æ–°å‰©é¤˜æ•¸é‡ (æ± å­è£¡ + ç•«é¢ä¸Š)
            const activeCount = onScreenWords.filter(w => w !== null).length;
            remainDisplay.textContent = pool.length + activeCount;
        }

        function gameOver() {
            endTitle.textContent = "ğŸ’” æŒ‘æˆ°å¤±æ•—";
            endTitle.style.color = "#e74c3c";
            endMsg.textContent = "åˆ¥æ°£é¤’ï¼Œå¤šè½å¹¾æ¬¡å°±ç†Ÿäº†ï¼";
            overlay.style.display = 'flex';
        }

        function gameWin() {
            endTitle.textContent = "ğŸ‰ å…¨æ•¸é€šé—œ";
            endTitle.style.color = "#2ecc71";
            endMsg.textContent = "å¤ªå¼·äº†ï¼æ‰€æœ‰ç”Ÿè©éƒ½è½æ‡‚äº†ï¼";
            overlay.style.display = 'flex';
        }

        // å•Ÿå‹•
        initGame();

    </script>
</body>
</html>